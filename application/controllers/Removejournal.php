<?phpini_set('MAX_EXECUTION_TIME', -1);ini_set('memory_limit','-1');class Removejournal extends CI_Controller {    /**     * Constructor     */    function __construct() {        parent::__construct(); 		$this->load->model('Removejournalmodel');		if(!$this->session->userdata('login')) redirect('');    }  		public function index(){ 				if(checkCurrentMenubyUserGroup()=="no") redirect(url_admin(), 'refresh');          $data['menu']		= 'karyailmiah/removejournal';        $this->load->view('theme',$data);    }    public function ajax_data(){				if (!$this->input->is_ajax_request()) exit('No direct script access allowed');		$table 		= "select * from knowledge_item where knowledge_type_id in (4,5,6)";		$colOrder 	= array(null,'code','title', 'author','editor', null, null, null); //set column field database for datatable orderable		$colSearch 	= array('code','title', 'author','editor'); //set column field database for datatable		$order 		= "order by created_at desc"; // default order  				$this->datatables->set_table($table);		$this->datatables->set_col_order($colOrder);		$this->datatables->set_col_search($colSearch);		$this->datatables->set_order($order); 				$list = $this->datatables->get_datatables();		        $data = array();        $no = $_POST['start'];        foreach ($list as $dt){            $no++;            $row = array();            $row[] = '<div class="text-center">'.$no.'</div>';            $row[] = $dt->code;            $row[] = $dt->title;            $row[] = $dt->author;            $row[] = $dt->editor;			$jurnal   	 		= $_SERVER['DOCUMENT_ROOT'].'/../symfony_projects/book/'.$dt->code.'/'.$dt->code.'_jurnal.pdf';			$jurnals   	 		= $_SERVER['DOCUMENT_ROOT'].'/../symfony_projects/book/'.$dt->code.'/'.$dt->code.'_jurnals.pdf';			$eproc   	 		= $_SERVER['DOCUMENT_ROOT'].'/../symfony_projects/book/'.$dt->code.'/'.$dt->code.'_jurnal_eproc.pdf';			$eprocs   	 		= $_SERVER['DOCUMENT_ROOT'].'/../symfony_projects/book/'.$dt->code.'/'.$dt->code.'_jurnal_eprocs.pdf';						if (file_exists($jurnal)){				  $row[] = '<div class="btn-group"> <button type="button" class="btn btn-sm btn-success" title="journal showed"><i class="fa fa-unlock"></i></button></div>'; 				  $jrnl = '<div class="btn-group"><button type="button" class="btn btn-sm btn-danger"  onclick="journal('."'".$dt->code."','hide'".')"><i class="fa fa-lock"></i>&nbsp;&nbsp;Hide Journal</button></div><br><br>';			}else if (file_exists($jurnals)){				  $row[] = '<div class="btn-group"> <button type="button" class="btn btn-sm btn-danger" title="journal hidden"><i class="fa fa-lock"></i></button></div>'; 				  $jrnl = '<div class="btn-group"><button type="button" class="btn btn-sm btn-success"  onclick="journal('."'".$dt->code."','show'".')"><i class="fa fa-unlock"></i>&nbsp;&nbsp;Show Journal</button></div><br><br>';			}			else{				  $row[] = "-";				  $jrnl = '';			}									if (file_exists($eproc)){				  $row[] = '<div class="btn-group"> <button type="button" class="btn btn-sm btn-success" title="journal eproc showed"><i class="fa fa-unlock"></i></button></div>'; 				  $eprc = '<div class="btn-group"><button type="button" class="btn btn-sm btn-danger"  onclick="eproc('."'".$dt->code."','hide'".')"><i class="fa fa-lock"></i>&nbsp;&nbsp;Hide Journal Eproc</button></div>';			}else if (file_exists($eprocs)){				  $row[] = '<div class="btn-group"><div class="btn-group"> <button type="button" class="btn btn-sm btn-danger" title="journal eproc hidden"><i class="fa fa-lock"></i></button></div>'; 				  $eprc = '<button type="button" class="btn btn-sm btn-success"  onclick="eproc('."'".$dt->code."','show'".')"><i class="fa fa-unlock"></i>&nbsp;&nbsp;Show Journal Eproc</button></div>';			}			else{				  $row[] = "-";				  $eprc = '';			}						            $row[] = ''.$jrnl.$eprc.'';             $data[] = $row;        }         $output = array(						"draw" => $_POST['draw'],						"recordsTotal" => $this->datatables->count_all(),						"recordsFiltered" => $this->datatables->count_filtered(),						"data" => $data,				);		echo json_encode($output);    }		function journal(){		if (!$this->input->is_ajax_request()) exit('No direct script access allowed');		$id 	= $this->input->post('id');		$status = $this->input->post('status');		$file 		= $_SERVER['DOCUMENT_ROOT'].'/../symfony_projects/book/'.$id.'/'.$id.'_jurnal.pdf';		$newfile 	= $_SERVER['DOCUMENT_ROOT'].'/../symfony_projects/book/'.$id.'/'.$id.'_jurnals.pdf';		if ($status=='hide'){			rename($file, $newfile);		}		else {			rename($newfile, $file);		}				echo json_encode(array("status" => TRUE));    }				function eproc(){		if (!$this->input->is_ajax_request()) exit('No direct script access allowed');		$id 	= $this->input->post('id');		$status = $this->input->post('status');		$file 		= $_SERVER['DOCUMENT_ROOT'].'/../symfony_projects/book/'.$id.'/'.$id.'_jurnal_eproc.pdf';		$newfile 	= $_SERVER['DOCUMENT_ROOT'].'/../symfony_projects/book/'.$id.'/'.$id.'_jurnal_eprocs.pdf';		if ($status=='hide'){			rename($file, $newfile);		}		else {			rename($newfile, $file);		}				echo json_encode(array("status" => TRUE));    }			 function insert(){		if (!$this->input->is_ajax_request()) exit('No direct script access allowed');        $item 					= $_POST['inp']; 		$item['datestart'] 		= convert_format_date($_POST['start']);		$item['datefinish'] 		= convert_format_date($_POST['end']);		$item['year'] 			= substr($_POST['end'],6,4);		if ($this->MonitoringEproceedingModel->add($item)) echo json_encode(array("status" => FALSE));		else echo json_encode(array("status" => TRUE));    }    function update(){		if (!$this->input->is_ajax_request()) exit('No direct script access allowed');        $id     = $this->input->post('id');        $item   = $_POST['inp'];  				$item['datestart'] 		= convert_format_date($_POST['start']);		$item['datefinish'] 		= convert_format_date($_POST['end']);		$item['year'] 			= substr($_POST['end'],6,4);		if ($this->MonitoringEproceedingModel->edit($id, $item)) echo json_encode(array("status" => FALSE));		else echo json_encode(array("status" => TRUE));    }    function edit(){		if (!$this->input->is_ajax_request()) exit('No direct script access allowed');        $id     = $this->input->post('id');        $data 	= $this->MonitoringEproceedingModel->getbyid($id)->row();		$data->datestart		= convert_format_date($data->datestart);		$data->datefinish 			= convert_format_date($data->datefinish);        echo json_encode($data);    } }?>